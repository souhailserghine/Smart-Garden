<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Event Management</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { padding: 30px; background-color: #f5f7fa; }
    .card { margin-bottom: 30px; }
    .table th { background-color: #0d6efd; color: white; }
    .btn { margin: 2px; }
</style>
</head>
<body>

<div class="container">

    <h1 class="mb-4 text-center">Event Management</h1>

   
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            Add New Event
        </div>
        <div class="card-body">
            <form id="addEventForm" class="row g-3">
                <div class="col-md-4">
                    <label for="type_event" class="form-label">Event Type</label>
                    <input type="text" class="form-control" id="type_event" name="type_event" required>
                </div>
                <div class="col-md-4">
                    <label for="date_event" class="form-label">Date</label>
                    <input type="date" class="form-control" id="date_event" name="date_event" required>
                </div>
                <div class="col-md-4">
                    <label for="etat" class="form-label">Status</label>
                    <select class="form-select" id="etat" name="etat">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-success">Add Event</button>
                </div>
            </form>
        </div>
    </div>

    
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            List of Events
        </div>
        <div class="card-body">
            <div id="loading">Loading events...</div>
            <table class="table table-hover table-bordered" id="eventsTable" style="display:none;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="eventsBody"></tbody>
            </table>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">Edit Event</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="editEventForm" class="row g-3">
                <input type="hidden" id="edit_id">
                <div class="col-12">
                    <label class="form-label">Type</label>
                    <input type="text" id="edit_type_event" class="form-control" required>
                </div>
                <div class="col-12">
                    <label class="form-label">Date</label>
                    <input type="date" id="edit_date_event" class="form-control" required>
                </div>
                <div class="col-12">
                    <label class="form-label">Status</label>
                    <select id="edit_etat" class="form-select">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="col-12 text-end mt-2">
                    <button type="submit" class="btn btn-success">Update</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>

</div>


<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
  <div id="toastContainer" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const toastEl = document.getElementById('toastContainer');
const toastMessage = document.getElementById('toastMessage');
const toast = new bootstrap.Toast(toastEl, { delay: 3000 });

const showToast = (message, type='success') => {
    toastMessage.innerText = message;
    toastEl.className = 'toast align-items-center text-white border-0 ' + (type==='success' ? 'bg-success' : 'bg-danger');
    toast.show();
};

const loadEvents = () => {
    fetch("index.php?action=getAll")
        .then(res => res.json())
        .then(res => {
            const table = document.getElementById("eventsTable");
            const body = document.getElementById("eventsBody");
            body.innerHTML = "";
            document.getElementById("loading").style.display = "none";
            table.style.display = "table";

            if(res.status === "success" && res.data.length > 0){
                res.data.forEach(event => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${event.event_id}</td>
                        <td>${event.type_event}</td>
                        <td>${event.date_event}</td>
                        <td>${event.etat}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editEvent(${event.event_id})">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEvent(${event.event_id})">Delete</button>
                        </td>
                    `;
                    body.appendChild(tr);
                });
            } else {
                body.innerHTML = `<tr><td colspan="5" class="text-center">No events found.</td></tr>`;
            }
        })
        .catch(err => {
            console.error(err);
            document.getElementById("loading").innerText = "Error loading events.";
        });
};


document.getElementById('addEventForm').addEventListener('submit', function(e){
    e.preventDefault();
    const data = {
        type_event: this.type_event.value,
        date_event: this.date_event.value,
        etat: this.etat.value
    };
    fetch("index.php?action=add", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
        showToast(res.message, res.status==='success' ? 'success' : 'error');
        if(res.status==='success') this.reset();
        loadEvents();
    });
});


const deleteEvent = (id) => {
    fetch(`index.php?action=delete&id=${id}`, { method: "POST" })
        .then(res => res.json())
        .then(res => {
            showToast(res.message, res.status==='success' ? 'success' : 'error');
            loadEvents();
        });
};


let editModal = new bootstrap.Modal(document.getElementById('editModal'));

const editEvent = (id) => {
    fetch(`index.php?action=getOne&id=${id}`)
        .then(res => res.json())
        .then(res => {
            if(res.status === "success"){
                document.getElementById("edit_id").value = res.data.event_id;
                document.getElementById("edit_type_event").value = res.data.type_event;
                document.getElementById("edit_date_event").value = res.data.date_event;
                document.getElementById("edit_etat").value = res.data.etat;
                editModal.show();
            }
        });
};


document.getElementById("editEventForm").addEventListener("submit", function(e){
    e.preventDefault();
    const id = document.getElementById("edit_id").value;
    const type_event = document.getElementById("edit_type_event").value;
    const date_event = document.getElementById("edit_date_event").value;
    const etat = document.getElementById("edit_etat").value;

    fetch(`index.php?action=update&id=${id}`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({type_event, date_event, etat})
    })
    .then(res => res.json())
    .then(res => {
        showToast(res.message, res.status==='success' ? 'success' : 'error');
        if(res.status === 'success') editModal.hide();
        loadEvents();
    });
});

window.onload = loadEvents;
</script>

</body>
</html>
